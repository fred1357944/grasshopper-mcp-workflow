flowchart LR
    %% 工業風書架 (Industrial Bookshelf) - GH 組件連接圖
    %% 生成時間: 2026-01-23 (更新: 參數名修正)
    %% 規格: 80×180×30cm, 5層, 金屬支架
    %% 狀態: ✅ 已部署成功
    %%
    %% 注意：參數名已統一使用全名 (Result, Point, Series 等)
    %% 請在 VSCode 中預覽：code GH_WIP/component_info.mmd

    subgraph PARAMS["參數 Sliders"]
        WIDTH["Number Slider<br/>nickname: Width<br/>value: 80<br/>range: 40-150"]
        HEIGHT["Number Slider<br/>nickname: Height<br/>value: 180<br/>range: 100-250"]
        DEPTH["Number Slider<br/>nickname: Depth<br/>value: 30<br/>range: 20-50"]
        SHELF_COUNT["Number Slider<br/>nickname: ShelfCount<br/>value: 5<br/>range: 2-10"]
        SHELF_T["Number Slider<br/>nickname: ShelfT<br/>value: 2<br/>range: 1-5"]
        SUPPORT_R["Number Slider<br/>nickname: SupportR<br/>value: 1.5<br/>range: 1-3"]
        BRACKET_R["Number Slider<br/>nickname: BracketR<br/>value: 0.8<br/>range: 0.5-1.5"]
        INSET["Number Slider<br/>nickname: Inset<br/>value: 5<br/>range: 3-10"]
        CONST_1["Number Slider<br/>nickname: Const1<br/>value: 1<br/>range: 0-2"]
        CONST_2["Number Slider<br/>nickname: Const2<br/>value: 2<br/>range: 0-4"]
    end

    subgraph CALC_Z["層板 Z 座標計算"]
        %% 層間距 = (Height - ShelfT) / (ShelfCount - 1)
        SUB_H["Subtraction<br/>nickname: HeightMinusT<br/>A=Height, B=ShelfT"]
        SUB_COUNT["Subtraction<br/>nickname: CountMinus1<br/>A=ShelfCount, B=Const1"]
        DIV_SPACING["Division<br/>nickname: Spacing<br/>A=HeightMinusT, B=CountMinus1"]

        %% 起始 Z = ShelfT / 2 (層板中心)
        DIV_START_Z["Division<br/>nickname: StartZ<br/>A=ShelfT, B=Const2"]

        %% Series 生成 Z 序列
        SERIES_Z["Series<br/>nickname: ShelfZs<br/>S=StartZ, N=Spacing, C=ShelfCount"]
    end

    subgraph CALC_X["支架 X 座標計算"]
        %% X = Width/2 - Inset
        DIV_HALF_W["Division<br/>nickname: HalfWidth<br/>A=Width, B=Const2"]
        SUB_INSET["Subtraction<br/>nickname: RightX<br/>A=HalfWidth, B=Inset"]
        NEG_X["Negative<br/>nickname: LeftX<br/>x=RightX"]
    end

    subgraph SHELF_GEO["層板幾何"]
        %% 層板中心點 (X=0, Y=0, Z=Series)
        CONST_0_X["Number Slider<br/>nickname: Zero<br/>value: 0"]
        PT_SHELF["Construct Point<br/>nickname: ShelfCenters<br/>X=Zero, Y=Zero, Z=ShelfZs"]
        PLANE_SHELF["XY Plane<br/>nickname: ShelfPlanes<br/>O=ShelfCenters"]

        %% 層板尺寸 (半尺寸)
        DIV_W2["Division<br/>nickname: HalfW<br/>A=Width, B=Const2"]
        DIV_D2["Division<br/>nickname: HalfD<br/>A=Depth, B=Const2"]
        DIV_T2["Division<br/>nickname: HalfT<br/>A=ShelfT, B=Const2"]

        %% Center Box
        BOX_SHELF["Center Box<br/>nickname: Shelves<br/>B=ShelfPlanes, X=HalfW, Y=HalfD, Z=HalfT"]
    end

    subgraph SUPPORT_GEO["支架幾何"]
        %% 左支架
        CONST_0_Y["Number Slider<br/>nickname: ZeroY<br/>value: 0"]
        CONST_0_Z["Number Slider<br/>nickname: ZeroZ<br/>value: 0"]
        PT_LEFT["Construct Point<br/>nickname: LeftBase<br/>X=LeftX, Y=ZeroY, Z=ZeroZ"]
        CYL_LEFT["Cylinder<br/>nickname: LeftSupport<br/>B=LeftBase, R=SupportR, L=Height"]

        %% 右支架
        PT_RIGHT["Construct Point<br/>nickname: RightBase<br/>X=RightX, Y=ZeroY, Z=ZeroZ"]
        CYL_RIGHT["Cylinder<br/>nickname: RightSupport<br/>B=RightBase, R=SupportR, L=Height"]
    end

    subgraph BRACKET_GEO["托架幾何"]
        %% 托架 Y 終點 = Depth / 2
        DIV_BRACKET_Y["Division<br/>nickname: BracketEndY<br/>A=Depth, B=Const2"]

        %% 左托架
        PT_BL_START["Construct Point<br/>nickname: LeftBracketStart<br/>X=LeftX, Y=ZeroY, Z=ShelfZs"]
        PT_BL_END["Construct Point<br/>nickname: LeftBracketEnd<br/>X=LeftX, Y=BracketEndY, Z=ShelfZs"]
        LINE_BL["Line<br/>nickname: LeftBracketLines<br/>Start Point=LeftBracketStart, End Point=LeftBracketEnd"]
        PIPE_BL["Pipe<br/>nickname: LeftBrackets<br/>Curve=LeftBracketLines, R=BracketR"]

        %% 右托架
        PT_BR_START["Construct Point<br/>nickname: RightBracketStart<br/>X=RightX, Y=ZeroY, Z=ShelfZs"]
        PT_BR_END["Construct Point<br/>nickname: RightBracketEnd<br/>X=RightX, Y=BracketEndY, Z=ShelfZs"]
        LINE_BR["Line<br/>nickname: RightBracketLines<br/>Start Point=RightBracketStart, End Point=RightBracketEnd"]
        PIPE_BR["Pipe<br/>nickname: RightBrackets<br/>Curve=RightBracketLines, R=BracketR"]
    end

    %% ===== 連接關係 =====

    %% ===== 連接關係 (使用全名參數) =====

    %% 參數 → 層板 Z 計算
    HEIGHT -->|"N → A"| SUB_H
    SHELF_T -->|"N → B"| SUB_H
    SHELF_COUNT -->|"N → A"| SUB_COUNT
    CONST_1 -->|"N → B"| SUB_COUNT
    SUB_H -->|"Result → A"| DIV_SPACING
    SUB_COUNT -->|"Result → B"| DIV_SPACING
    SHELF_T -->|"N → A"| DIV_START_Z
    CONST_2 -->|"N → B"| DIV_START_Z
    DIV_START_Z -->|"Result → S"| SERIES_Z
    DIV_SPACING -->|"Result → N"| SERIES_Z
    SHELF_COUNT -->|"N → C"| SERIES_Z

    %% 參數 → 支架 X 計算
    WIDTH -->|"N → A"| DIV_HALF_W
    CONST_2 -->|"N → B"| DIV_HALF_W
    DIV_HALF_W -->|"Result → A"| SUB_INSET
    INSET -->|"N → B"| SUB_INSET
    SUB_INSET -->|"Result → x"| NEG_X

    %% 層板幾何連接
    CONST_0_X -->|"N → X"| PT_SHELF
    CONST_0_X -->|"N → Y"| PT_SHELF
    SERIES_Z -->|"Series → Z"| PT_SHELF
    PT_SHELF -->|"Point → Origin"| PLANE_SHELF
    WIDTH -->|"N → A"| DIV_W2
    CONST_2 -->|"N → B"| DIV_W2
    DEPTH -->|"N → A"| DIV_D2
    CONST_2 -->|"N → B"| DIV_D2
    SHELF_T -->|"N → A"| DIV_T2
    CONST_2 -->|"N → B"| DIV_T2
    PLANE_SHELF -->|"Plane → Base"| BOX_SHELF
    DIV_W2 -->|"Result → X"| BOX_SHELF
    DIV_D2 -->|"Result → Y"| BOX_SHELF
    DIV_T2 -->|"Result → Z"| BOX_SHELF

    %% 左支架連接
    NEG_X -->|"x → X"| PT_LEFT
    CONST_0_Y -->|"N → Y"| PT_LEFT
    CONST_0_Z -->|"N → Z"| PT_LEFT
    PT_LEFT -->|"Point → Base"| CYL_LEFT
    SUPPORT_R -->|"N → R"| CYL_LEFT
    HEIGHT -->|"N → L"| CYL_LEFT

    %% 右支架連接
    SUB_INSET -->|"Result → X"| PT_RIGHT
    CONST_0_Y -->|"N → Y"| PT_RIGHT
    CONST_0_Z -->|"N → Z"| PT_RIGHT
    PT_RIGHT -->|"Point → Base"| CYL_RIGHT
    SUPPORT_R -->|"N → R"| CYL_RIGHT
    HEIGHT -->|"N → L"| CYL_RIGHT

    %% 托架 Y 計算
    DEPTH -->|"N → A"| DIV_BRACKET_Y
    CONST_2 -->|"N → B"| DIV_BRACKET_Y

    %% 左托架連接
    NEG_X -->|"x → X"| PT_BL_START
    CONST_0_Y -->|"N → Y"| PT_BL_START
    SERIES_Z -->|"Series → Z"| PT_BL_START
    NEG_X -->|"x → X"| PT_BL_END
    DIV_BRACKET_Y -->|"Result → Y"| PT_BL_END
    SERIES_Z -->|"Series → Z"| PT_BL_END
    PT_BL_START -->|"Point → Start Point"| LINE_BL
    PT_BL_END -->|"Point → End Point"| LINE_BL
    LINE_BL -->|"Line → Curve"| PIPE_BL
    BRACKET_R -->|"N → R"| PIPE_BL

    %% 右托架連接
    SUB_INSET -->|"Result → X"| PT_BR_START
    CONST_0_Y -->|"N → Y"| PT_BR_START
    SERIES_Z -->|"Series → Z"| PT_BR_START
    SUB_INSET -->|"Result → X"| PT_BR_END
    DIV_BRACKET_Y -->|"Result → Y"| PT_BR_END
    SERIES_Z -->|"Series → Z"| PT_BR_END
    PT_BR_START -->|"Point → Start Point"| LINE_BR
    PT_BR_END -->|"Point → End Point"| LINE_BR
    LINE_BR -->|"Line → Curve"| PIPE_BR
    BRACKET_R -->|"N → R"| PIPE_BR
