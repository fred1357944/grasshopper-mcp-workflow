{
  "_meta": {
    "version": "1.0.0",
    "description": "透過 Claude Code 對話累積的 GH 知識模式",
    "updated_at": "2026-01-27T09:41:48.103984"
  },
  "patterns": {
    "wasp_connection_geo_mesh": {
      "rule": "WASP Connection From Direction 的 GEO 輸入必須接 Mesh，不能接 Brep",
      "reason": "Connection 需要從 Mesh 面提取中心點和法向量，Brep 無法直接提取",
      "category": "wasp",
      "severity": "critical",
      "learned_from": "WASP Cube Aggregation 排錯經驗",
      "learned_at": "2025-01-24",
      "confidence": 1.0
    },
    "slider_range_before_value": {
      "rule": "設定 Number Slider 時，必須先設定 min/max 範圍，再設定 value",
      "reason": "Slider 預設範圍 0-1，如果先設 value=360 會被 clamp 到 1",
      "category": "general",
      "severity": "critical",
      "learned_from": "Spiral Staircase 排錯經驗",
      "learned_at": "2025-01-20",
      "confidence": 1.0
    },
    "panel_not_for_numbers": {
      "rule": "Panel 組件不能作為數值輸入源，必須使用 Number Slider",
      "reason": "Panel 輸出是文字類型，傳給數學組件會顯示虛線（無資料流）",
      "category": "general",
      "severity": "critical",
      "learned_from": "Spiral Staircase 排錯經驗",
      "learned_at": "2025-01-20",
      "confidence": 1.0
    },
    "rotate_guid_conflict": {
      "rule": "Rotate 組件必須使用 GUID 19c70daf-600f-4697-ace2-567f6702144d",
      "reason": "VectorComponents 有同名 Rotate，fuzzy search 會返回錯誤組件",
      "category": "guid",
      "severity": "critical",
      "learned_from": "組件衝突排錯",
      "learned_at": "2025-01-22",
      "confidence": 1.0
    },
    "clear_document_not_canvas": {
      "rule": "清空畫布使用 clear_document，不是 clear_canvas",
      "reason": "clear_canvas 命令不存在，會報錯",
      "category": "mcp",
      "severity": "critical",
      "learned_from": "MCP API 測試",
      "learned_at": "2025-01-18",
      "confidence": 1.0
    },
    "list_objects_not_exist": {
      "rule": "查詢組件列表使用 get_document_info，不是 list_objects",
      "reason": "list_objects 命令不存在，正確命令是 get_document_info，返回 components 陣列",
      "category": "mcp",
      "severity": "critical",
      "learned_from": "WASP L-Shape 部署排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "send_command_kwargs_format": {
      "rule": "send_command 參數使用 **kwargs 格式，不是 dict",
      "reason": "client.send_command('cmd', param1=val1) 正確，client.send_command('cmd', {'param1': val1}) 錯誤",
      "category": "mcp",
      "severity": "critical",
      "learned_from": "WASP L-Shape 連接排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "wasp_aggregation_param_order": {
      "rule": "WASP Stochastic Aggregation 參數順序: PART(0), PREV(1), N(2), RULES(3), SEED(4)",
      "reason": "連接時必須使用正確的 paramIndex，否則會連到錯誤參數",
      "category": "wasp",
      "severity": "critical",
      "learned_from": "WASP L-Shape 部署排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "line_sdl_needs_all_inputs": {
      "rule": "Line SDL 組件需要三個輸入: S(起點), D(方向), L(長度)",
      "reason": "缺少任何輸入都會導致輸出為空，進而導致下游組件出錯",
      "category": "general",
      "severity": "high",
      "learned_from": "WASP L-Shape WASP Connection 紅色排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "wasp_connection_needs_direction": {
      "rule": "WASP Connection 的 UP 輸入需要有效的方向向量/線段",
      "reason": "UP 定義連接點的上方向，如果 Line SDL 輸出為空，整個 WASP 工作流程會失敗",
      "category": "wasp",
      "severity": "critical",
      "learned_from": "WASP L-Shape WASP Connection 紅色排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "center_box_param_order": {
      "rule": "Center Box 參數順序: Base(Plane,0), X(size,1), Y(size,2), Z(size,3) - 數值連 1/2/3，不是 0！",
      "reason": "Base(索引0) 接收 Plane 平面，不是數值！Number Slider 必須連到 X(1)/Y(2)/Z(3)",
      "category": "general",
      "severity": "critical",
      "learned_from": "WASP L-Shape Box 紅色排錯 - 連續兩次犯同樣錯誤",
      "learned_at": "2026-01-26",
      "confidence": 1.0,
      "param_mapping": {
        "Base": {
          "index": 0,
          "type": "Plane",
          "note": "不要連數值！"
        },
        "X": {
          "index": 1,
          "type": "Number"
        },
        "Y": {
          "index": 2,
          "type": "Number"
        },
        "Z": {
          "index": 3,
          "type": "Number"
        }
      },
      "example": {
        "correct": "Slider -> Box (toParamIndex=1 for X)",
        "wrong": "Slider -> Box (toParamIndex=0 for Base)"
      }
    },
    "panel_value_manual_only": {
      "rule": "GH_MCP 無法自動設定 Panel 內容，必須手動輸入",
      "reason": "set_panel_value, set_panel_content 等命令都不存在，Panel 值只能手動設定",
      "category": "mcp",
      "severity": "medium",
      "learned_from": "WASP L-Shape Part.NAME 設定",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "set_slider_properties_with_id": {
      "rule": "設定 Slider 用 set_slider_properties，參數名是 id 不是 componentId",
      "reason": "set_slider_properties(id=xxx, min=..., max=..., value=...) 是正確格式",
      "category": "mcp",
      "severity": "medium",
      "learned_from": "WASP L-Shape Slider 設定",
      "learned_at": "2026-01-26",
      "confidence": 1.0
    },
    "connect_use_param_name_not_index": {
      "rule": "連接組件使用 sourceParam/targetParam (參數名稱)，不是 sourceParamIndex/targetParamIndex",
      "reason": "GH_MCP connect_components 支援參數名稱，用名稱更可靠，用索引容易接錯",
      "category": "mcp",
      "severity": "critical",
      "learned_from": "WASP L-Shape 完整排錯 - 對比 placement_info_v10.json",
      "learned_at": "2026-01-26",
      "confidence": 1.0,
      "example": {
        "correct": "sourceParam='N', targetParam='X'",
        "wrong": "sourceParamIndex=0, targetParamIndex=1"
      }
    },
    "wasp_stochaggr_reset_required": {
      "rule": "WASP Stochastic Aggregation 的 RESET 輸入必須連接 Boolean Toggle",
      "reason": "沒有 RESET 連接，聚集無法正確重置，會導致不可預測的行為",
      "category": "wasp",
      "severity": "critical",
      "learned_from": "Golden Knowledge cube_basic_aggregation.json + WASP L-Shape 排錯",
      "learned_at": "2026-01-26",
      "confidence": 1.0,
      "connection": {
        "from": "Boolean Toggle",
        "fromParamIndex": 0,
        "to": "Stochastic Aggregation",
        "toParam": "RESET"
      },
      "_source": "golden_knowledge + 對話經驗"
    },
    "placement_info_must_have_reset": {
      "rule": "WASP 工作流程的 placement_info.json 必須包含 Boolean Toggle + RESET 連接",
      "reason": "多個歷史版本 (v3-v10) 都有 TOGGLE_RESET 組件，但新生成的版本漏掉了",
      "category": "wasp",
      "severity": "critical",
      "learned_from": "placement_info.json 缺失 RESET 導致聚集失敗",
      "learned_at": "2026-01-26",
      "confidence": 1.0,
      "checklist": [
        "components[] 包含 Boolean Toggle (nickname: Reset)",
        "connections[] 包含 Toggle -> Aggregation.RESET"
      ]
    },
    "compare_with_golden_knowledge": {
      "rule": "部署前必須對比 Golden Knowledge，確保所有必要連接存在",
      "reason": "Golden Knowledge 包含專家驗證的完整連接模式，遺漏會導致錯誤",
      "category": "workflow",
      "severity": "critical",
      "learned_from": "RESET 遺漏事件 - 未查詢 cube_basic_aggregation.json",
      "learned_at": "2026-01-26",
      "confidence": 1.0,
      "golden_files": [
        "config/golden_knowledge/wasp/cube_basic_aggregation.json",
        "config/connection_triplets.json"
      ]
    }
  },
  "categories": {
    "wasp": "WASP 插件相關",
    "karamba": "Karamba3D 結構分析",
    "kangaroo": "Kangaroo 物理模擬",
    "general": "通用 Grasshopper 規則",
    "guid": "組件 GUID 衝突",
    "mcp": "MCP 命令相關"
  },
  "intent_patterns": {
    "aggregation": {
      "patterns": [
        "4_05_Graph_Grammar_Aggregation",
        "4_03_Wasp_to_DisCo_VR",
        "4_04_Smart_Attributes",
        "4_01_Local_Constraints_Supports",
        "4_03_Local_Constraints_Adjacencies",
        "4_06_Global_Constraints_Mesh",
        "4_05_Global_Constraints_Plane",
        "4_04_Local_Constraints_Orientation",
        "4_02_Local_Constraints_Additional_Collider",
        "0_10_Aggregation_Graph",
        "0_06_Part_Attributes",
        "0_02_MultiPart_Aggregation",
        "0_07_Save_Load_Aggregation",
        "0_05_Transform_Part_Aggregation_Start",
        "0_09_Parts_Catalog",
        "0_04_Part_Geometry_Replacement",
        "0_03_Vertex_Edge_Connections",
        "0_01_Basic_Aggregation",
        "0_08_Aggregation_w_Fixed_Seed",
        "1_05_Rules_From_Aggregation",
        "1_04_Rules_Visualizer",
        "1_01_Rules_Generator_Basics",
        "1_02_Rules_Connection_Types",
        "1_03_Rules_Grammar",
        "5_02_Hierarchical_Aggregation_LEGO",
        "5_01_Hierarchical_Aggregation",
        "2_08_Orientable_Field",
        "2_05_Field_from_Kangaroo",
        "2_09_Field_From_Surface",
        "2_04_Field_from_Expression",
        "2_02_Field_Boundaries",
        "2_06_MultiChannel_Field",
        "2_03_Field_from_Curves",
        "2_01_Field_Basics",
        "2_11_Combining_Fields",
        "2_10_Volumetric_Field",
        "2_07_Save_Load_Field",
        "4_02_TopOpt_Field_tOpos",
        "4_01_TopOpt_Field_Millipede"
      ],
      "keywords": [
        "level:medium",
        "curve",
        "wasp",
        "solid",
        "parametric",
        "mesh"
      ]
    }
  }
}