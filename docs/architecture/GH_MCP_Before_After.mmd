%%{init: {'theme': 'base'}}%%

flowchart TB
    subgraph BEFORE["âŒ Before (v1.x) â€” åªæœ‰èªæ³•æª¢æŸ¥"]
        direction TB
        B_INPUT["placement_info.json"]
        B_CHECK["Pre-Execution Checker<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>âœ“ GUID é©—è­‰<br/>âœ“ åƒæ•¸åé©—è­‰<br/>âœ“ MCP å‘½ä»¤é©—è­‰<br/>âœ— èªç¾©é©—è­‰ (ç¼ºå¤±!)"]
        B_EXEC["Execute"]
        B_CRASH["ğŸ’¥ CRASH<br/>Rhino å´©æ½°"]

        B_INPUT --> B_CHECK
        B_CHECK --> B_EXEC
        B_EXEC --> B_CRASH
    end

    subgraph AFTER["âœ… After (v2.0) â€” èªæ³• + èªç¾© é›™é‡é©—è­‰"]
        direction TB
        A_INPUT["placement_info.json"]

        subgraph A_SYNTAX["Phase 3: èªæ³•é©—è­‰"]
            A_CHECK["Pre-Execution Checker<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>âœ“ GUID é©—è­‰<br/>âœ“ åƒæ•¸åé©—è­‰<br/>âœ“ MCP å‘½ä»¤é©—è­‰"]
        end

        subgraph A_SEMANTIC["Phase 2: èªç¾©å¯©æŸ¥ ğŸ§  (NEW!)"]
            A_REVIEW["LLM Semantic Review<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>âœ“ çµ„ä»¶è¡Œç‚ºç†è§£<br/>âœ“ è³‡æ–™æµè¿½è¹¤<br/>âœ“ ã€Œçˆ†ç‚¸é»ã€è­˜åˆ¥<br/>âœ“ ç”¨æˆ¶ç¢ºèª"]
        end

        A_CONFIRM{"ç”¨æˆ¶ç¢ºèª"}
        A_EXEC["Execute"]
        A_SUCCESS["âœ… SUCCESS"]

        A_INPUT --> A_SEMANTIC
        A_SEMANTIC --> A_CONFIRM
        A_CONFIRM -->|"ç¢ºèª"| A_SYNTAX
        A_SYNTAX --> A_EXEC
        A_EXEC --> A_SUCCESS
    end

    %% æ¨£å¼
    classDef before fill:#ffebee,stroke:#f44336,stroke-width:2px
    classDef after fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    classDef semantic fill:#fff3e0,stroke:#ff9800,stroke-width:3px
    classDef crash fill:#f44336,stroke:#b71c1c,color:#fff
    classDef success fill:#4caf50,stroke:#2e7d32,color:#fff

    class BEFORE before
    class AFTER after
    class A_SEMANTIC semantic
    class B_CRASH crash
    class A_SUCCESS success
